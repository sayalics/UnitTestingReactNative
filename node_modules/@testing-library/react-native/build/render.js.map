{"version":3,"file":"render.js","names":["render","component","wrapper","Wrapper","createNodeMock","wrap","innerElement","renderer","renderWithAct","undefined","update","updateWithAct","instance","root","unmount","act","addToCleanupQueue","result","getQueriesForElement","container","rerender","toJSON","debug","setRenderResult","options","TestRenderer","create","debugImpl","message","json","debugDeep","shallow","debugShallow"],"sources":["../src/render.tsx"],"sourcesContent":["import TestRenderer from 'react-test-renderer';\nimport type { ReactTestInstance, ReactTestRenderer } from 'react-test-renderer';\nimport * as React from 'react';\nimport act from './act';\nimport { addToCleanupQueue } from './cleanup';\nimport debugShallow from './helpers/debugShallow';\nimport debugDeep from './helpers/debugDeep';\nimport { getQueriesForElement } from './within';\nimport { setRenderResult } from './screen';\n\nexport type RenderOptions = {\n  wrapper?: React.ComponentType<any>;\n  createNodeMock?: (element: React.ReactElement) => any;\n};\n\ntype TestRendererOptions = {\n  createNodeMock: (element: React.ReactElement) => any;\n};\n\nexport type RenderResult = ReturnType<typeof render>;\n\n/**\n * Renders test component deeply using react-test-renderer and exposes helpers\n * to assert on the output.\n */\nexport default function render<T>(\n  component: React.ReactElement<T>,\n  { wrapper: Wrapper, createNodeMock }: RenderOptions = {}\n) {\n  const wrap = (innerElement: React.ReactElement) =>\n    Wrapper ? <Wrapper>{innerElement}</Wrapper> : innerElement;\n\n  const renderer = renderWithAct(\n    wrap(component),\n    createNodeMock ? { createNodeMock } : undefined\n  );\n  const update = updateWithAct(renderer, wrap);\n  const instance = renderer.root;\n  const unmount = () => {\n    act(() => {\n      renderer.unmount();\n    });\n  };\n\n  addToCleanupQueue(unmount);\n\n  const result = {\n    ...getQueriesForElement(instance),\n    update,\n    unmount,\n    container: instance,\n    rerender: update, // alias for `update`\n    toJSON: renderer.toJSON,\n    debug: debug(instance, renderer),\n  };\n\n  setRenderResult(result);\n  return result;\n}\n\nfunction renderWithAct(\n  component: React.ReactElement,\n  options?: TestRendererOptions\n): ReactTestRenderer {\n  let renderer: ReactTestRenderer;\n\n  act(() => {\n    renderer = TestRenderer.create(component, options);\n  });\n\n  // @ts-ignore act is sync, so renderer is always initialised here\n  return renderer;\n}\n\nfunction updateWithAct(\n  renderer: ReactTestRenderer,\n  wrap: (innerElement: React.ReactElement) => React.ReactElement\n) {\n  return function (component: React.ReactElement) {\n    act(() => {\n      renderer.update(wrap(component));\n    });\n  };\n}\n\ninterface DebugFunction {\n  (message?: string): void;\n  shallow: (message?: string) => void;\n}\n\nfunction debug(\n  instance: ReactTestInstance,\n  renderer: ReactTestRenderer\n): DebugFunction {\n  function debugImpl(message?: string) {\n    const json = renderer.toJSON();\n    if (json) {\n      return debugDeep(json, message);\n    }\n  }\n  debugImpl.shallow = (message?: string) => debugShallow(instance, message);\n  return debugImpl;\n}\n"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;AAaA;AACA;AACA;AACA;AACe,SAASA,MAAT,CACbC,SADa,EAEb;EAAEC,OAAO,EAAEC,OAAX;EAAoBC;AAApB,IAAsD,EAFzC,EAGb;EACA,MAAMC,IAAI,GAAIC,YAAD,IACXH,OAAO,gBAAG,oBAAC,OAAD,QAAUG,YAAV,CAAH,GAAuCA,YADhD;;EAGA,MAAMC,QAAQ,GAAGC,aAAa,CAC5BH,IAAI,CAACJ,SAAD,CADwB,EAE5BG,cAAc,GAAG;IAAEA;EAAF,CAAH,GAAwBK,SAFV,CAA9B;EAIA,MAAMC,MAAM,GAAGC,aAAa,CAACJ,QAAD,EAAWF,IAAX,CAA5B;EACA,MAAMO,QAAQ,GAAGL,QAAQ,CAACM,IAA1B;;EACA,MAAMC,OAAO,GAAG,MAAM;IACpB,IAAAC,YAAA,EAAI,MAAM;MACRR,QAAQ,CAACO,OAAT;IACD,CAFD;EAGD,CAJD;;EAMA,IAAAE,0BAAA,EAAkBF,OAAlB;EAEA,MAAMG,MAAM,GAAG,EACb,GAAG,IAAAC,4BAAA,EAAqBN,QAArB,CADU;IAEbF,MAFa;IAGbI,OAHa;IAIbK,SAAS,EAAEP,QAJE;IAKbQ,QAAQ,EAAEV,MALG;IAKK;IAClBW,MAAM,EAAEd,QAAQ,CAACc,MANJ;IAObC,KAAK,EAAEA,KAAK,CAACV,QAAD,EAAWL,QAAX;EAPC,CAAf;EAUA,IAAAgB,uBAAA,EAAgBN,MAAhB;EACA,OAAOA,MAAP;AACD;;AAED,SAAST,aAAT,CACEP,SADF,EAEEuB,OAFF,EAGqB;EACnB,IAAIjB,QAAJ;EAEA,IAAAQ,YAAA,EAAI,MAAM;IACRR,QAAQ,GAAGkB,0BAAA,CAAaC,MAAb,CAAoBzB,SAApB,EAA+BuB,OAA/B,CAAX;EACD,CAFD,EAHmB,CAOnB;;EACA,OAAOjB,QAAP;AACD;;AAED,SAASI,aAAT,CACEJ,QADF,EAEEF,IAFF,EAGE;EACA,OAAO,UAAUJ,SAAV,EAAyC;IAC9C,IAAAc,YAAA,EAAI,MAAM;MACRR,QAAQ,CAACG,MAAT,CAAgBL,IAAI,CAACJ,SAAD,CAApB;IACD,CAFD;EAGD,CAJD;AAKD;;AAOD,SAASqB,KAAT,CACEV,QADF,EAEEL,QAFF,EAGiB;EACf,SAASoB,SAAT,CAAmBC,OAAnB,EAAqC;IACnC,MAAMC,IAAI,GAAGtB,QAAQ,CAACc,MAAT,EAAb;;IACA,IAAIQ,IAAJ,EAAU;MACR,OAAO,IAAAC,kBAAA,EAAUD,IAAV,EAAgBD,OAAhB,CAAP;IACD;EACF;;EACDD,SAAS,CAACI,OAAV,GAAqBH,OAAD,IAAsB,IAAAI,qBAAA,EAAapB,QAAb,EAAuBgB,OAAvB,CAA1C;;EACA,OAAOD,SAAP;AACD"}
{"version":3,"file":"timers.js","names":["globalObj","window","global","runWithRealTimers","callback","fakeTimersType","getJestFakeTimersType","jest","useRealTimers","callbackReturnValue","fakeTimersConfig","getFakeTimersConfigFromType","useFakeTimers","setTimeout","_isMockFunction","clock","getRealSystemTime","type","legacyFakeTimers","jestFakeTimersAreEnabled","Boolean","setImmediatePolyfill","fn","bindTimeFunctions","clearTimeoutFn","clearTimeout","setImmediateFn","setImmediate","setTimeoutFn"],"sources":["../../src/helpers/timers.ts"],"sourcesContent":["// Most content of this file sourced directly from https://github.com/testing-library/dom-testing-library/blob/main/src/helpers.js\n/* globals jest */\nconst globalObj = typeof window === 'undefined' ? global : window;\n\ntype FakeTimersTypes = 'modern' | 'legacy';\n\n// Currently this fn only supports jest timers, but it could support other test runners in the future.\nfunction runWithRealTimers<T>(callback: () => T): T {\n  const fakeTimersType = getJestFakeTimersType();\n  if (fakeTimersType) {\n    jest.useRealTimers();\n  }\n\n  const callbackReturnValue = callback();\n\n  if (fakeTimersType) {\n    const fakeTimersConfig = getFakeTimersConfigFromType(fakeTimersType);\n    jest.useFakeTimers(fakeTimersConfig);\n  }\n\n  return callbackReturnValue;\n}\n\nfunction getJestFakeTimersType(): FakeTimersTypes | null {\n  // istanbul ignore if\n  if (\n    typeof jest === 'undefined' ||\n    typeof globalObj.setTimeout === 'undefined'\n  ) {\n    return null;\n  }\n\n  if (\n    // @ts-expect-error jest mutates setTimeout\n    typeof globalObj.setTimeout._isMockFunction !== 'undefined' &&\n    // @ts-expect-error jest mutates setTimeout\n    globalObj.setTimeout._isMockFunction\n  ) {\n    return 'legacy';\n  }\n\n  if (\n    // @ts-expect-error jest mutates setTimeout\n    typeof globalObj.setTimeout.clock !== 'undefined' &&\n    typeof jest.getRealSystemTime !== 'undefined'\n  ) {\n    try {\n      // jest.getRealSystemTime is only supported for Jest's `modern` fake timers and otherwise throws\n      jest.getRealSystemTime();\n      return 'modern';\n    } catch {\n      // not using Jest's modern fake timers\n    }\n  }\n\n  return null;\n}\n\nfunction getFakeTimersConfigFromType(type: FakeTimersTypes) {\n  return type === 'legacy'\n    ? { legacyFakeTimers: true }\n    : { legacyFakeTimers: false };\n}\n\nconst jestFakeTimersAreEnabled = (): boolean =>\n  Boolean(getJestFakeTimersType());\n\n// we only run our tests in node, and setImmediate is supported in node.\nfunction setImmediatePolyfill(fn: Function) {\n  return globalObj.setTimeout(fn, 0);\n}\n\ntype BindTimeFunctions = {\n  clearTimeoutFn: typeof clearTimeout;\n  setImmediateFn: typeof setImmediate;\n  setTimeoutFn: typeof setTimeout;\n};\n\nfunction bindTimeFunctions(): BindTimeFunctions {\n  return {\n    clearTimeoutFn: globalObj.clearTimeout,\n    setImmediateFn: globalObj.setImmediate || setImmediatePolyfill,\n    setTimeoutFn: globalObj.setTimeout,\n  };\n}\n\nconst { clearTimeoutFn, setImmediateFn, setTimeoutFn } = runWithRealTimers(\n  bindTimeFunctions\n) as BindTimeFunctions;\n\nexport {\n  runWithRealTimers,\n  jestFakeTimersAreEnabled,\n  clearTimeoutFn as clearTimeout,\n  setImmediateFn as setImmediate,\n  setTimeoutFn as setTimeout,\n};\n"],"mappings":";;;;;;;;AAAA;;AACA;AACA,MAAMA,SAAS,GAAG,OAAOC,MAAP,KAAkB,WAAlB,GAAgCC,MAAhC,GAAyCD,MAA3D;;AAIA;AACA,SAASE,iBAAT,CAA8BC,QAA9B,EAAoD;EAClD,MAAMC,cAAc,GAAGC,qBAAqB,EAA5C;;EACA,IAAID,cAAJ,EAAoB;IAClBE,IAAI,CAACC,aAAL;EACD;;EAED,MAAMC,mBAAmB,GAAGL,QAAQ,EAApC;;EAEA,IAAIC,cAAJ,EAAoB;IAClB,MAAMK,gBAAgB,GAAGC,2BAA2B,CAACN,cAAD,CAApD;IACAE,IAAI,CAACK,aAAL,CAAmBF,gBAAnB;EACD;;EAED,OAAOD,mBAAP;AACD;;AAED,SAASH,qBAAT,GAAyD;EACvD;EACA,IACE,OAAOC,IAAP,KAAgB,WAAhB,IACA,OAAOP,SAAS,CAACa,UAAjB,KAAgC,WAFlC,EAGE;IACA,OAAO,IAAP;EACD;;EAED,KACE;EACA,OAAOb,SAAS,CAACa,UAAV,CAAqBC,eAA5B,KAAgD,WAAhD,IACA;EACAd,SAAS,CAACa,UAAV,CAAqBC,eAJvB,EAKE;IACA,OAAO,QAAP;EACD;;EAED,KACE;EACA,OAAOd,SAAS,CAACa,UAAV,CAAqBE,KAA5B,KAAsC,WAAtC,IACA,OAAOR,IAAI,CAACS,iBAAZ,KAAkC,WAHpC,EAIE;IACA,IAAI;MACF;MACAT,IAAI,CAACS,iBAAL;MACA,OAAO,QAAP;IACD,CAJD,CAIE,MAAM,CACN;IACD;EACF;;EAED,OAAO,IAAP;AACD;;AAED,SAASL,2BAAT,CAAqCM,IAArC,EAA4D;EAC1D,OAAOA,IAAI,KAAK,QAAT,GACH;IAAEC,gBAAgB,EAAE;EAApB,CADG,GAEH;IAAEA,gBAAgB,EAAE;EAApB,CAFJ;AAGD;;AAED,MAAMC,wBAAwB,GAAG,MAC/BC,OAAO,CAACd,qBAAqB,EAAtB,CADT,C,CAGA;;;;;AACA,SAASe,oBAAT,CAA8BC,EAA9B,EAA4C;EAC1C,OAAOtB,SAAS,CAACa,UAAV,CAAqBS,EAArB,EAAyB,CAAzB,CAAP;AACD;;AAQD,SAASC,iBAAT,GAAgD;EAC9C,OAAO;IACLC,cAAc,EAAExB,SAAS,CAACyB,YADrB;IAELC,cAAc,EAAE1B,SAAS,CAAC2B,YAAV,IAA0BN,oBAFrC;IAGLO,YAAY,EAAE5B,SAAS,CAACa;EAHnB,CAAP;AAKD;;AAED,MAAM;EAAEW,cAAF;EAAkBE,cAAlB;EAAkCE;AAAlC,IAAmDzB,iBAAiB,CACxEoB,iBADwE,CAA1E"}